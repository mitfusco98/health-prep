
{% extends "base.html" %}

{% block title %}Cache Management{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h2>Cache Management</h2>
    
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Hit Rate</h5>
                    <h3 class="text-success">{{ stats.hit_rate }}%</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Requests</h5>
                    <h3>{{ stats.total_requests }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Cache Hits</h5>
                    <h3 class="text-success">{{ stats.hits }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Cache Misses</h5>
                    <h3 class="text-danger">{{ stats.misses }}</h3>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Cache Backend</h5>
                    <span class="badge badge-{{ 'success' if stats.backend == 'redis' else 'warning' }}">
                        {{ stats.backend|title }}
                    </span>
                    {% if stats.backend == 'memory' %}
                        <p class="mt-2 text-muted">
                            Memory Cache Size: {{ stats.memory_cache_size }} entries
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                <h5 class="card-title">Cache Operations</h5>
                <p>Sets: {{ stats.sets }}</p>
                <p>Deletes: {{ stats.deletes }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Cache Actions</h5>
                    <button id="clearCacheBtn" class="btn btn-danger">Clear All Cache</button>
                    <button id="refreshStatsBtn" class="btn btn-primary">Refresh Stats</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('clearCacheBtn').addEventListener('click', function() {
    if (confirm('Are you sure you want to clear all cache? This cannot be undone.')) {
        fetch('/admin/cache/clear', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Cache cleared successfully');
                location.reload();
            } else {
                alert('Error clearing cache: ' + data.message);
            }
        });
    }
});

document.getElementById('refreshStatsBtn').addEventListener('click', function() {
    location.reload();
});
</script>
{% endblock %}
